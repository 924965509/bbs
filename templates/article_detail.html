{% extends 'base.html' %}

{% block page-main %}

    <div class="article-detail">

        <h1>{{ article.title }}</h1>
        <p>{{ article.articledetail.content|safe }}</p>
    </div>

    <div id="div_digg">
        <div class="diggit action">
            <span class="diggnum" id="digg_count">{{ article.up_count }}</span>
        </div>
        <div class="buryit action">
            <span class="burynum" id="bury_count">{{ article.down_count }}</span>
        </div>
        <div class="clear"></div>
        <div class="diggword" id="digg_tips" style="color: red;"></div>
    </div>
    {% csrf_token %}
    <script>
        $("#div_digg .action").click(function () {
            {#赞或者踩#}
            var is_up = $(this).hasClass("diggit");
            var article_id ="{{ article.pk }}"

            $.ajax({
                url:"/blog/updown/",
                type:"post",
                data:{
                    is_up:is_up,
                    article_id:article_id,
                    csrfmiddlewaretoken:$("[name='csrfmiddlewaretoken']").val()
                },
                success:function (data) {
                    console.log(data);
                    if (data.state){
                        if(is_up){
                            var val = $("#digg_count").text();
                            val = parseInt(val) + 1
                            $("#digg_count").text(val)
                        }else {
                            var val = $("#bury_count").text();
                            val = parseInt(val) + 1
                            $("#bury_count").text(val)
                        }
                    }
                    else {

                        if (data.is_up){
                            $("#digg_tips").html("你已经点赞过了")

                        }else {
                            $("#digg_tips").html("你已经反对过了")

                        }
                        setTimeout(function () {
                            $("#digg_tips").html("")

                        },1000)
                    }
                }
            })

        })


    </script>

{% endblock %}
